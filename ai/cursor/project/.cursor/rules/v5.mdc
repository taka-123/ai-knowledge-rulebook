---
alwaysApply: true
globs: ["**"]
description: Cursor 用コーディング基盤ルール（このテンプレートを各プロジェクトの .cursor/rules/v5.mdc にコピー）
---

# v5: コーディング支援ルール（Cursor版）

前提: プロジェクトの `AGENTS.md` / `CLAUDE.md`（共通ルール）を読み込んだ上で、Cursor 専用の追加ガイドとして本ファイルを適用する。競合時はシステム > 共通ルール > 本ファイルの優先度で従う。

---

## 0. 共通前提

- 対象タスク: コーディング支援、リファクタリング、デバッグ、開発関連ドキュメント作成
- 言語: ユーザーの使用言語に従う（指定なければ日本語）
- 完了方針: 途中で打ち切らず、依頼を満たすまでやり切る。制約で完遂できない場合は進捗と残タスクを明示
- 命令の優先: ユーザー指示が曖昧/競合なら短く確認してから進める
- 応答スタイル: 結論ファースト・簡潔。例示コードは必要最小限

---

## 1. タスク分類と推論深度（🟢/🟡/🔴）

ワークスペース共通の分類に従う。ここではコーディング時の深度だけ定義する。

### 🟢 軽量
- 例: 単一ファイルの数行修正、簡単な原因特定
- フロー: 1行要約 → 必要ファイルだけ `read_file` → 即 `apply_patch` → 1〜2文報告

### 🟡 標準
- 例: 複数ファイルの小〜中規模改修、コンポーネント追加
- フロー: 3〜7項目のチェックリスト提示 → 関連ファイルを読む → `apply_patch` を段階適用 → lint/型を可能な範囲で確認 → 変更要約

### 🔴 重要
- 例: 認証/DB/インフラ/料金・本番影響
- フロー: 影響とロールバックを含む Plan を提示し承認後に着手

---

## 2. ツール利用ポリシー（Cursor）

- `read_file`: 変更前に必ず関連ファイルを読む。大きい場合は必要箇所のみ
- `apply_patch`: 主要な変更手段。意味的にまとまった単位で分割する
- `grep` / `codebase_search`: 位置特定とパターン調査に使う
- 並列実行: 読み取り系（read/grep/search/web）は依存がなければ並列可。状態変更系と並列にしない
- `run_terminal_cmd`: ビルド/テスト等が明らかに必要、またはユーザー指示時のみ。長時間は is_background を利用
- Web検索: 仕様・料金・バージョン依存・エラーメッセージ調査では積極活用。検索した場合は何を調べたか1〜2文共有

---

## 3. コーディング標準フロー

### 🟢 軽量
1. タスクを1行で要約
2. 関連1〜2ファイルを読む
3. すぐ `apply_patch`
4. 1〜2文で結果報告

### 🟡 標準
1. 目的・制約・影響を短く整理
2. チェックリストを提示
3. ファイルをまとめて読み、段階的に `apply_patch`
4. 可能なら lint/型を確認
5. どのファイルをどう変えたか要約

### 🔴 重要
- Plan 提示 → 承認 → 小さなステップで実装。各ステップで状態確認

---

## 4. エラー・セキュリティ・コスト

- 自分が導入した lint/型エラーは可能な限りその場で解消
- `any` 追加や意図的なデグレードは禁止。やむを得ず回避する場合は理由・リスクを明示
- 認証/ネットワーク/料金を伴う変更は 🔴 扱いとし、Plan & 承認を経て実施

---

## 5. 出力スタイル

- 🟢: 1〜2文の報告で十分。テンプレ多用しない
- 🟡/🔴: 見出し＋箇条書きで変更点・影響・注意点を整理
- コード引用はパス付きで最小範囲。推論ログは求められたときのみ詳細化

---

このルールに従い、共通の `AGENTS.md` を土台にしつつ、Cursor のツール群を安全かつ効率的に活用すること。
