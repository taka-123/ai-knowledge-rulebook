---
alwaysApply: true
globs: ["**"]
description: テスト実装タスクの標準プロセス（等価分割・境界値・分岐網羅を明示）
---

## テスト戦略ルール

テストコードの追加・更新時に必ず従うプロセス。軽微なメッセージ調整だけで新しい分岐が増えない場合は表更新を省略可。

---

## 1. テスト観点表（必須）

1. 着手前に Markdown 形式の表を提示する（Case ID / Input / Perspective / Expected / Notes）。
2. 正常・異常・境界値を網羅。境界値候補（0 / 最小 / 最大 / ±1 / 空 / NULL）は意味がなければ Notes に理由を書いて省略可。
3. 観点漏れに気づいたら表を更新してから実装を続行。

テンプレート例:

| Case ID | Input / Precondition | Perspective (Equivalence / Boundary) | Expected Result | Notes |
|---------|----------------------|--------------------------------------|-----------------|-------|
| TC-N-01 | Valid input A        | Equivalence – normal                 | Expected value  | -     |
| TC-A-01 | NULL                 | Boundary – NULL                      | Validation error| -     |

---

## 2. 実装ポリシー

- 表に列挙したケースをすべて自動化する。
- 正常系と同数以上の失敗系を含める。
- 網羅観点: 正常 / 異常 / 境界値 / 不正型・形式 / 外部依存失敗 / 例外種別・メッセージ。
- 分岐網羅 100% を目標。合理的でない場合は主要分岐を優先し、未カバー理由を明示。

## 3. Given / When / Then コメント

各テストに以下のコメントを付与する:

```
// Given: 前提条件
// When:  実行する操作
// Then:  期待する結果/検証
```

## 4. 例外・エラー検証

- 例外の型とメッセージを明示的に検証。
- バリデーション系ではエラーコード/フィールド情報があれば併せて確認。
- 外部依存失敗はスタブ/モックを使い、リトライやフォールバックも確認。

## 5. 実行コマンドとカバレッジ

- テスト実行コマンドとカバレッジ取得方法を PR/ドキュメント末尾に記載（例: `npm run test`, `pytest --cov ...`）。
- ブランチ/ステートメントカバレッジを確認し、結果を簡潔に共有。

## 6. 運用上の注意

- 本ルールに合わない差分はレビューで差し戻す。
- 外部依存がなくても失敗系はモック等で擬似的に失敗させる。
- 新しい分岐や制約を追加したら観点表とテストを同時更新。
- 自動化が困難な場合は理由と代替の手動検証手順を明記し、レビュアと合意する。

---

欠落観点がないか自己チェックしつつテストを設計・実装すること。
