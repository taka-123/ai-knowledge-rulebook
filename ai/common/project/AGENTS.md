# プロジェクト固有ガイドライン

> Motto: "既存アーキテクチャの絶対遵守と、意図せぬ変更のゼロ化"

## 適用順序と JIT 読み込み

作業開始時に以下を近い階層優先で統合する。

- 作業対象から親へ遡ってツール固有ルール（`.cursor/rules/`, `.windsurf/rules/`, `./.agent/rules/` など）と `AGENTS.md` を順にロードする。

## プロジェクトソース（必要時参照）

- ドキュメントと実態に乖離が疑われる場合、鵜呑みにせず、実ディレクトリ・設定ファイル・指針と照合し、必要なら更新を提案する。

- **全体概要**: README.md
- **技術スタック/バージョン**: technologystack.md
- **ディレクトリ構造/命名規則**: directorystructure.md

## 計画時の必須分析

- `rg` / `grep` で類似機能・コンポーネント・ユーティリティを探索し、再利用可否を示す。
- 変更の影響先（特に共有型定義・API 仕様）を特定する。

## 実装ポリシー

- **一貫性**: 既存の変換・エラーハンドリング・非同期パターンを一字一句レベルで踏襲せよ。
- **最小化**: 既存コードの文字コード、データ形式、UI/UX デザイン（余白・色・フォント）は指示がない限り変更しない。
- **無断変更禁止**: 指示外の変更は提案のみとし、実装は承認後に行う。

## 承認必須の変更（レッドライン）

以下の変更は実装前に必ず `【確認待ち】` セクションを設けて承認を得ること。

- ランタイム、主要ライブラリ（SDK）のバージョン変更。
- データベーススキーマ、API 仕様、通信プロトコルの変更。
- インフラ、セキュリティ設定の変更。
- 要件外のリファクタリング。

## レビュー基準（`@codex review` / `/review`）

`@codex review` (または `/review`) 実行時は、以下の基準で厳格に判定せよ。

- **P0 (Blocker)**: 誤動作、セキュリティ欠陥、アーキテクチャ違反。 -> **マージ不可**
- **P1 (Critical)**: 命名規約違反、不適切なエラー処理、既存機能への回帰リスク。 -> **マージ不可**
- **P2 (Normal)**: 性能最適化の余地、重複コード、可読性向上。 -> フォローアップ可
- **P3 (Nit)**: 軽微なタイポ、好みの提案。 -> 任意

- **総合判定**: 可 / 不可
- **指摘事項**: 重要度の高い順に、根拠（一次情報の参照）と「最小の修正案」をセットで提示せよ。

## 作業前チェックリスト

- [ ] ドキュメント上の SDK バージョンと、実際のマニフェストファイルが一致しているか確認したか。
- [ ] `rg` 等を用いてプロジェクト内の既存のコードパターンを探索したか。
- [ ] 変更範囲に `.env` などの機密情報が含まれていないか再確認したか。
- [ ] 報告は global 層のタスク分類（🟢🟡🔴）に準拠しているか。
