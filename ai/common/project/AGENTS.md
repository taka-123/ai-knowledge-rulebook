# プロジェクト固有ガイドライン

> Motto: "既存アーキテクチャの絶対遵守と、意図せぬ変更のゼロ化"

---

## 0. プロジェクト正典（真実のソース）

AI は作業開始時、以下のドキュメントを必ずロードし、実装の基盤とせよ。
**注意**:ドキュメントと実態に乖離がある疑いがある場合（例：SDK バージョン）、`package.json` や `README.md` を直接 `cat` して確認し、必要ならドキュメントの更新を提案せよ。

- **全体概要**: README.md
- **技術スタック/バージョン**: technologystack.md
- **ディレクトリ構造/命名規則**: directorystructure.md

---

## 1. 思考プロトコル：Scaffolding First

実装計画（Plan）を提示する際、以下の「プロジェクト整合性チェック」を必ず含めよ。

### タスク分析（プロジェクト層）

- **既存の再利用**: `rg` や `grep` を活用し、類似機能、コンポーネント、ユーティリティ関数の有無を徹底的に検索した結果を報告せよ。
- **依存関係**: 変更が影響を与える他モジュール（特に共有型定義や API 仕様）を特定せよ。

---

## 2. 実行・実装ポリシー

### 2.1 変更の原則

- **ルール優先度**: project（本ファイル） ＞ multi_service_parent ＞ global。競合時は本ファイルを優先。
- **一貫性**: 既存の変換・エラーハンドリング・非同期パターンを一字一句レベルで踏襲せよ。
- **最小化**: 既存コードの文字コード、データ形式、UI/UX デザイン（余白・色・フォント）を、**指示がない限り絶対に変更するな**。
- **無断変更禁止**: 指示にない変更は提案のみ。実装は承認後。

### 2.2 承認が必要な「レッドライン」

以下の変更は実装前に必ず `【確認待ち】` セクションを設けて承認を得ること。

- ランタイム、主要ライブラリ（SDK）のバージョン変更。
- データベーススキーマ、API 仕様、通信プロトコルの変更。
- インフラ、セキュリティ設定の変更。
- 要件外のリファクタリング。

---

## 3. コードレビュー・ゲートキーパー

`@codex review` (または `/review`) 実行時は、以下の基準で厳格に判定せよ。

### 判定基準と優先度

- **P0 (Blocker)**: 誤動作、セキュリティ欠陥、アーキテクチャ違反。 -> **マージ不可**
- **P1 (Critical)**: 命名規約違反、不適切なエラー処理、既存機能への回帰リスク。 -> **マージ不可**
- **P2 (Normal)**: 性能最適化の余地、重複コード、可読性向上。 -> フォローアップ可
- **P3 (Nit)**: 軽微なタイポ、好みの提案。 -> 任意

### レビュー出力

1. **総合判定**: 可 / 不可
2. **指摘事項**: 重要度の高い順に、根拠（一次情報の参照）と「最小の修正案」をセットで提示せよ。

---

## 4. 作業前最終チェックリスト

- [ ] ドキュメント上の SDK バージョンと、実際のマニフェストファイルが一致しているか確認したか。
- [ ] `rg` 等を用いてプロジェクト内の既存のコードパターンを探索したか。
- [ ] 変更範囲に `.env` などの機密情報が含まれていないか再確認したか。
- [ ] 報告は global 層のタスク分類（🟢🟡🔴）に準拠しているか。
